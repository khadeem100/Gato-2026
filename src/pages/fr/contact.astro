---
import Layout from "../../layouts/Layout.astro";
import { getTranslator } from "../../lib/i18n.ts";

const __ = await getTranslator(Astro.currentLocale)
---
<Layout
  title={__("Contact us")}
  description={__("Get in touch with our compliance experts")}
>
  <main>
    <animated-hero class="block py-10 sm:py-20 relative overflow-hidden">
      <section class="container">
        <h1 class="text-h2 mb-10 font-medium animate-slide-in text-center">
          {__("Talk to a compliance expert")}
        </h1>
        <iframe id="tally-form" data-tally-src="https://tally.so/embed/pbel5B?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1&hideBranding=1" loading="lazy" width="100%" height="729" frameborder="0" marginheight="0" marginwidth="0" title="Probo peut gérer votre conformité"></iframe>
      </section>
    </animated-hero>
  </main>
</Layout>

<script>
  import {AnimatedHero} from '../../lib/elements/hero'
  import {customElementDefine} from '../../lib/dom'

  customElementDefine('animated-hero', () => AnimatedHero)

  // Load Tally form on page load (including client-side navigation)
  function loadTallyForm() {
    const iframe = document.getElementById('tally-form') as HTMLIFrameElement;
    if (!iframe || iframe.src) return;
    
    const tallySrc = iframe.dataset.tallySrc;
    if (!tallySrc) return;

    const w = "https://tally.so/widgets/embed.js";
    
    if (typeof (window as any).Tally !== "undefined") {
      iframe.src = tallySrc;
      (window as any).Tally.loadEmbeds();
    } else if (!document.querySelector(`script[src="${w}"]`)) {
      const s = document.createElement("script");
      s.src = w;
      s.onload = () => {
        iframe.src = tallySrc;
        if (typeof (window as any).Tally !== "undefined") {
          (window as any).Tally.loadEmbeds();
        }
      };
      document.body.appendChild(s);
    } else {
      iframe.src = tallySrc;
    }
  }

  document.addEventListener('astro:page-load', loadTallyForm);
</script>
