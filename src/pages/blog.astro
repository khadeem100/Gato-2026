---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import WrittenBy from "../components/block/WrittenBy.astro";
import { pageSize } from "../content.config.ts";
import Pagination from "../components/Pagination.astro";
import { filterLang, getLink, getTranslator } from "../lib/i18n.ts";
const allPosts = (await getCollection("blog", filterLang(Astro.currentLocale))).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
const lastPage = Math.ceil(allPosts.length / pageSize);
const posts = allPosts.slice(0, pageSize);
const dateFormatter = Intl.DateTimeFormat("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
const __ = await getTranslator(Astro.currentLocale)
---

<Layout title="Blog" description="The latest news, insights, and practical guides about compliance, security certifications, SOC 2, ISO 27001, and GDPR from the Probo team.">
  <main class="container my-10 sm:my-20">
    <h1
      class="text-h2 mb-3 font-medium animate-slide-in"
    >
      {__("Blog")}
    </h1>
    <p
      class="text-muted-foreground mb-10 text-base sm:mb-16 animate-slide-in animation-delay-100"
    >
      {__("The latest news from Probo")}
    </p>
    <div
      class="flex flex-col items-start gap-10 sm:grid sm:grid-cols-[1fr_320px] sm:gap-30 animate-slide-in animation-delay-300"
    >
      <section>
        {
          posts.map((post: any) => (
            <article class="border-b py-10 first:pt-0 last:border-b-0 space-y-3">
              <div class="text-muted-foreground">
                {dateFormatter.format(new Date(post.data.date))}, by{" "}
                {post.data.author.name}
              </div>
              <h2>
                <a
                  href={getLink(Astro, `/blog/${post.id.split('/').at(-1)}`)}
                  class="text-h4 block font-medium hover:opacity-80"
                >
                  {post.data.title}
                </a>
              </h2>
              <p class="text-muted-foreground text-lg">{post.data.excerpt}</p>
            </article>
          ))
        }
        <Pagination currentPage={1} lastPage={lastPage} url="/blog" />
      </section>
      <aside
        class="sticky top-20 animate-slide-in animation-delay-200"
      >
        <WrittenBy />
      </aside>
    </div>
  </main>
</Layout>
