---
import { getTranslator } from "../../lib/i18n";
import ComplianceTrackItem from "../ui/ComplianceTrackItem.astro";
const __ = await getTranslator(Astro.currentLocale);
---

<section class="animate-fade-in animation-delay-500 container py-10 sm:py-20">
  <h2
    class="text-h3 sm:text-h2 intersect-once intersect:animate-slide-in mb-3 text-center font-medium"
  >
    {__("Van aanvraag tot levering")}
  </h2>
  <p
    class="text-muted-foreground intersect-once intersect:animate-slide-in motion-delay-100 mx-auto mb-10 max-w-180 text-center text-lg sm:mb-16"
  >
    {
      __(
        "Wij begeleiden u door het hele proces - van eerste aanvraag en ontwerp tot productie en levering. Zo kunt u zich focussen op uw bedrijf terwijl wij zorgen voor perfecte bedrukte producten.",
      )
    }
  </p>
  <compliance-track class="flex flex-col gap-6 sm:flex-row sm:gap-16">
    <ComplianceTrackItem position="01" title={__("Aanvraag & Offerte")}>
      {
        __(
          "Stuur ons uw logo, ontwerp, gewenste producten en aantallen. Wij bekijken uw aanvraag en sturen binnen 24 uur een vrijblijvende offerte met de beste druktechniek voor uw project.",
        )
      }</ComplianceTrackItem
    >
    <ComplianceTrackItem position="02" title={__("Drukproef & Goedkeuring")}>
      {
        __(
          "Na akkoord op de offerte ontvangt u een digitale drukproef. Zo ziet u precies hoe het eindresultaat eruit komt te zien. Na uw goedkeuring starten wij direct met de productie.",
        )
      }
    </ComplianceTrackItem>
    <ComplianceTrackItem position="03" title={__("Productie & Levering")}>
      {__("Binnen 2 weken na goedkeuring van uw drukproef leveren wij uw bestelling. Al onze producten worden milieuvriendelijk geproduceerd met de hoogste kwaliteitsnormen.")}
    </ComplianceTrackItem>
  </compliance-track>
</section>

<script>
  import { customElementDefine } from "../../lib/dom";

  class ComplianceTrack extends HTMLElement {
    observer: IntersectionObserver | null = null;
    timer: ReturnType<typeof setTimeout> | null = null;

    connectedCallback() {
      let step = 0;
      this.observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const tick = () => {
              step++;
              if (step < 3) {
                this.timer = setTimeout(tick, 2000);
                this.children[step - 1]?.setAttribute("data-active", "true");
              }

              // Update the UI
              this.children[step - 1]?.setAttribute("data-active", "true");
            };
            this.timer = setTimeout(tick, 1000);
          }
        });
      });
      this.observer.observe(this);
    }

    disconnectedCallback() {
      if (this.timer) {
        clearTimeout(this.timer);
      }
      if (this.observer) {
        this.observer.disconnect();
      }
    }
  }

  customElementDefine("compliance-track", () => ComplianceTrack);
</script>

<style>
  .compliance-item[data-active] .square {
    animation: squareIn 0.5s ease-in-out;
  }
  @keyframes squareIn {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(0.5);
    }
    0% {
      transform: scale(1);
    }
  }
</style>
