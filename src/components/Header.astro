---
import { Image } from "astro:assets";
import Logo from "../assets/probo-logo.svg";
import NavLink from "./NavLink.astro";
import Button from "./ui/Button.svelte";
import MobileMenu from "./MobileMenu.astro";
import GithubStars from "./GithubStars.astro";
import { getLink, getTranslator } from "../lib/i18n.ts";

const __ = await getTranslator(Astro.currentLocale);
type Props = {
  hideBurger: boolean
}
---

<header class="page-header text-primary data-[scrolled=true]:bg-secondary/80 sticky top-0 z-50 data-[scrolled=true]:backdrop-blur-md transition-all data-[scrolled=true]:border-b">
  <div class="container mx-auto flex items-center py-3 sm:py-4">
    <a class="mr-auto" href={getLink(Astro, "/")} transition:name="header-logo">
      <Image src={Logo} alt="Logo Gato-International" width={73} height={20} class="block" />
    </a>
    <nav class="hidden sm:flex" transition:name="header-nav">
      <NavLink href={getLink(Astro, "/about")}>{__("Over Ons")}</NavLink>
      <NavLink href="https://catalog.gato-international.com">{__("Catalogus")}</NavLink>
      <NavLink href="https://www.gatosports.com">{__("GatoSports")}</NavLink>
      <NavLink href={getLink(Astro, "/contact")}>{__("Contact")}</NavLink>
          </nav>
    <div
      transition:name="header-compliant"
    >
      <Button
        href={getLink(Astro, "/contact")}
        class="ml-auto h-9 px-4 sm:ml-4 sm:h-8 sm:px-3 whitespace-nowrap"
      >
        {__("Offerte Aanvragen")}
      </Button>
    </div>    <slot/>
    {!Astro.props.hideBurger && <burger-menu
      class="group ml-3 grid size-9 place-items-center sm:hidden"
      aria-label="Open mobile menu"
    >
      <svg
        width="16"
        height="16"
        viewBox="0 0 16 16"
        xmlns="http://www.w3.org/2000/svg"
        class="group-aria-selected:hidden"
      >
        <path
          d="M2 8H14M2 4H14M2 12H14"
          stroke="#141E12"
          stroke-width="1.33333"
          stroke-linecap="round"
          stroke-linejoin="round"></path>
      </svg>
      <svg
        width="16"
        height="16"
        viewBox="0 0 16 16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="hidden group-aria-selected:block"
      >
        <path
          d="M3.33325 3.33594L12.6666 12.6693M12.6666 3.33594L3.33325 12.6693"
          stroke="black"
          stroke-width="1.33333"
          stroke-linecap="round"></path>
      </svg>
    </burger-menu>}
  </div>
</header>

<MobileMenu id="mobile-menu" />

<script>
  import { customElementDefine } from "../lib/dom";

  class BurgerMenu extends HTMLElement {
    scrolled = null as null | boolean;

    connectedCallback() {
      this.addEventListener("click", () => {
        const sidebar = document.querySelector(
          "#mobile-menu"
        ) as HTMLDialogElement;
        const sidebarOpen = !sidebar.hasAttribute("open");
        if (sidebarOpen) {
          sidebar.setAttribute("open", "");
          this.setAttribute("aria-selected", "true");
          document.body.style.overflow = "hidden";
        } else {
          sidebar.removeAttribute("open");
          this.removeAttribute("aria-selected");
          document.body.style.removeProperty("overflow");
        }
      });
      window.addEventListener('scroll', this.onScroll)
      this.onScroll()
    }

    disconnectedCallback () {
      window.removeEventListener('scroll', this.onScroll)
    }

    onScroll = () => {
      const isScrolled = document.documentElement.scrollTop > 10
      // Skip the logic if we already have scrolled

      if (isScrolled === this.scrolled) {
        return;
        }
        this.closest('header')?.setAttribute('data-scrolled', isScrolled.toString())
        this.scrolled = isScrolled
    }
  }

  customElementDefine("burger-menu", () => BurgerMenu);
</script>
