---
import { getImage } from "astro:assets";
import type { UnresolvedImageTransform } from "astro";

type Props = {
  mobile: [number, number];
  alt: string;
  sm: [number, number];
  src: Promise<{ default: ImageMetadata }> | ImageMetadata;
  class?: string;
  fetchpriority?: "high" | "low" | "auto";
};

const props = Astro.props;

const mobileImage = await getImage({
  width: props.mobile[0],
  height: props.mobile[1],
  fit: "cover",
  src: props.src,
  alt: props.alt,
} as UnresolvedImageTransform);

const mobileImage2x = await getImage({
  width: props.mobile[0] * 2,
  height: props.mobile[1] * 2,
  fit: "cover",
  src: props.src,
  alt: props.alt,
} as UnresolvedImageTransform);

const smImage = await getImage({
  width: props.sm[0],
  height: props.sm[1],
  fit: "cover",
  src: props.src,
  alt: props.alt,
} as UnresolvedImageTransform);

const smImage2x = await getImage({
  width: props.sm[0] * 2,
  height: props.sm[1] * 2,
  fit: "cover",
  src: props.src,
  alt: props.alt,
} as UnresolvedImageTransform);
---

<picture>
  <source
    media={`(max-width: 640px)`}
    width={props.mobile[0]}
    height={props.mobile[1]}
    srcset={`${mobileImage.src} 1x, ${mobileImage2x.src} 2x`}
  />
  <source
    media="(min-width: 640px)"
    width={props.sm[0]}
    height={props.sm[1]}
    srcset={`${smImage.src} 1x, ${smImage2x.src} 2x`}
  />
  <img src={mobileImage.src} alt={props.alt} class={props.class} fetchpriority={props.fetchpriority} />
</picture>
