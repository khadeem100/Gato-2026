---
import { getLink } from "../lib/i18n.ts";

export interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface Props {
  items: BreadcrumbItem[];
  class?: string;
}

const { items, class: className } = Astro.props;

// Build the full breadcrumb list with Home at the start
const breadcrumbs: BreadcrumbItem[] = [
  { label: "Home", href: "/" },
  ...items,
];

// Generate structured data for SEO
const structuredData = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: breadcrumbs.map((item, index) => ({
    "@type": "ListItem",
    position: index + 1,
    name: item.label,
    ...(item.href && { item: new URL(getLink(Astro, item.href), Astro.site).toString() }),
  })),
};
---

<nav aria-label="Breadcrumb" class:list={["text-sm", className]}>
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  <ol class="flex flex-wrap items-center gap-1.5">
    {
      breadcrumbs.map((crumb, index) => {
        const isLast = index === breadcrumbs.length - 1;
        return (
          <li class="flex items-center gap-1.5">
            {index > 0 && (
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-quaternary"
                aria-hidden="true"
              >
                <path d="m9 18 6-6-6-6" />
              </svg>
            )}
            {isLast || !crumb.href ? (
              <span class="text-muted-foreground">{crumb.label}</span>
            ) : (
              <a
                href={getLink(Astro, crumb.href)}
                class="text-quaternary transition-colors hover:text-primary"
              >
                {crumb.label}
              </a>
            )}
          </li>
        );
      })
    }
  </ol>
</nav>

